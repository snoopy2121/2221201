<!DOCTYPE html>
<head>
    <meta charset="UTF-8">
    <title>ARスタンプラリー</title>
    <link rel="stylesheet" href="main.css">
</head>
<html>

<body>

    <div class="layer layer-bg">
      <div class="layer-in layer-txt">
          ARを体験しながら、熊谷の街を知ろう!!
      </div>
    </div>
    
    <h1><p><font color="red" size="9">星渓園</font></p></h1>
      <div class="pizza">
        <p><font size="3"></font><iframe src="https://www.google.com/maps/embed?pb=!1m23!1m12!1m3!1d291695.76945478545!2d139.20200591458587!3d36.122403935344245!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m8!3e6!4m0!4m5!1s0x601f29c8c5d0fb05%3A0x37edca368e85bac4!2z44CSMzYwLTAwNDYg5Z-8546J55yM54aK6LC35biC6Y6M5YCJ55S677yT77ySIOaYn-a6quWckg!3m2!1d36.1442592!2d139.3813197!5e0!3m2!1sja!2sjp!4v1664433076295!5m2!1sja!2sjp" width="400" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"><br><br></iframe><a href="https://snoopy2121.github.io/20221201/ARkansei/index.seikei.html" class="btn"><font size="5">ARを体験してみよう！</font></a>
      </p>
      <img src="./seikeien.jpg" alt="">
    </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    <h1><p><font color="red" size="9">熊谷スポーツ文化公園</font></p></h1>
    <div class="pizza">
      <p><font size="3"></font><iframe src="https://www.google.com/maps/embed?pb=!1m23!1m12!1m3!1d3221.0312405123677!2d139.40444811744385!3d36.16579439999999!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m8!3e6!4m0!4m5!1s0x601f28ff3bd0cc31%3A0x9ad7bc04f7255b5d!2z44CSMzYwLTAwMzcg5Z-8546J55yM54aK6LC35biC5LiK5bed5LiK77yT77yQ77yQIOeGiuiwt-OCueODneODvOODhOaWh-WMluWFrOWckg!3m2!1d36.165794399999996!2d139.4066368!5e0!3m2!1sja!2sjp!4v1666328486714!5m2!1sja!2sjp" width="400" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe><br><br><a href=></a><a href="https://snoopy2121.github.io/20221201/ARkansei/index.sport.html" class="btn"><font size="5">ARを体験してみよう！</font></a>
      </p>
      <img src="./sport.jpg" alt="">
    </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    <h1><p><font color="red" size="9">熊谷桜堤</font></p></h1>
    <div class="pizza">
      <p><font size="3"></font><iframe src="https://www.google.com/maps/embed?pb=!1m23!1m12!1m3!1d3222.256279464958!2d139.3859271!3d36.1359728!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!4m8!3e6!4m0!4m5!1s0x601f29c06b69946d%3A0xdafa3b72206a5213!2z44CSMzYwLTAwMzUg5Z-8546J55yM54aK6LC35biC5rKz5Y6f55S677yS5LiB55uuIOeGiuiwt-ahnOWgpA!3m2!1d36.1359728!2d139.3859271!5e0!3m2!1sja!2sjp!4v1666332795446!5m2!1sja!2sjp" width="400" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe><br><br></a><a href="https://snoopy2121.github.io/20221201/ARkansei/index.sakura.html" class="btn"><font size="5">ARを体験してみよう！</font></a>
      </p>
      <img src="./sakura.jpg" alt="">
    </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
    <h1><p><font color="red" size="9">熊谷之次郎直美像</font></p></h1>
    <div class="pizza">
      <p><font size="3"></font><iframe src="https://www.google.com/maps/embed?pb=!1m18!1m12!1m3!1d3222.0749752074976!2d139.3895995!3d36.140387700000005!2m3!1f0!2f0!3f0!3m2!1i1024!2i768!4f13.1!3m3!1m2!1s0x601f29be957a295d%3A0x97bef1ffe78936e4!2z54aK6LC35LmL5qyh6YOO55u05a6f5YOP!5e0!3m2!1sja!2sjp!4v1666333161143!5m2!1sja!2sjp" width="400" height="300" style="border:0;" allowfullscreen="" loading="lazy" referrerpolicy="no-referrer-when-downgrade"></iframe><br><br></a><a href="https://snoopy2121.github.io/20221201/ARkansei/index.naozane.html" class="btn"><font size="5">ARを体験してみよう！</font></a>
      </p>
      <img src="./naozane.jpg" alt="">
    </div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br>
<div id="page_top"><a href="#"></a></div>
<div id="page_top"><a href="#"></a></div>


    <div class="bg_pattern Paper_v2"></div>
    <div class="section">
    </div>
  </body>
</style>

<style>
  /* Google マップを表示させるためには style 内で width と height の指定が必要 */
  #mapDiv {width: 100%; height: 400px;}

  /*#player {
 	position: absolute; 
 	top:0; 
 	width: 100%; 
 	height: 100%; 
 	background: #FFF; 
 	z-index: 9999999999;
 }*/
</style>
</head>
</html>
<body>
<div id="mapDiv"></div>                             <!-- 地図を置くdiv要素 -->
<img id="getImg" src="" hidden>                     <!-- ★捕獲した人魚を表示するimg要素 -->
<canvas id="cap" width="300" height="60"></canvas>  <!-- ★捕獲済人魚を入れるcanvas要素 -->

<article>
  <!--<video type="video/webm" src="./video.mov" controls></video>-->
<video id="player" preload>
	<source src="/.video.mov" type="video/webm">
</video>
</article>
</body>
</html>
<script>
var mapDiv = document.getElementById("mapDiv");     // 地図を置く場所
var gmap;                                           // Googleマップの Map オブジェクトのための変数
var mark;                                           // Googleマップの Marker オブジェクトのための変数

var mermaids = [];                                  // ★人魚の情報を入れる変数
var captured = [];                                  // ★人魚を捕獲済みか否かを入れる変数
loadMermaids();                                     // ★人魚の情報を読み込む
var getImg = document.getElementById("getImg");     // ★img要素の取得
var canvas = document.getElementById("cap");        // ★捕獲済人魚を入れるcanvas要素の取得
var context = canvas.getContext("2d");              // ★contextの取得
context.fillStyle = "rgb(153, 217, 234)";           // ★塗りつぶす色をターコイズにする
context.fillRect(0, 0, 300, 60);                    // ★canvasを塗りつぶす

// GPS センサの値が変化したら何らか実行する geolocation.watchPosition メソッド
navigator.geolocation.watchPosition( (position) => {
  var lat  = position.coords.latitude;            // 緯度を取得
  var lng  = position.coords.longitude;           // 経度を取得
  var accu = position.coords.accuracy;            // 緯度・経度の精度を取得
  showMyPos(lat, lng);                            // showMyPos 関数を実行
  calcDistance(lat, lng);
});

// 自分の位置を表示する showMyPos 関数
function showMyPos(lat, lng) {
  var myPos = new google.maps.LatLng(lat, lng);   // Googleマップの LatLng オブジェクトを作成
  gmap.setCenter(myPos);                          // gmap の中心を myPos の位置にする
  mark.setPosition(myPos);                        // mark の位置を myPos にする
}

// 地図の初期化
function initMap() {
  // 1回だけ現在位置を測定する getCurrentPosition メソッド
  navigator.geolocation.getCurrentPosition( (position) => {
      var lat = position.coords.latitude;         // 緯度を取得
      var lng = position.coords.longitude;        // 経度を取得
      var initPos = new google.maps.LatLng(lat, lng); // 初期位置を指定
      gmap = new google.maps.Map(mapDiv, {        // Map オブジェクトを作成して mapDiv に表示
          center: initPos,                        // 地図の中心を initPos に設定
          zoom: 16                                // ズーム倍率
      });
      mark = new google.maps.Marker({             // Marker オブジェクトを作成
          map: gmap,                              // gmap の上に表示する
          position: initPos,                      // initPos の位置に
      });
      placeMermaids();                            // ★人魚を配置する
  }, (error) => {                                 // エラー処理（今回は特に何もしない）
  }, {
      enableHighAccuracy: true                    // 高精度で測定するオプション
  });
}

// ★人魚の情報を読み込む loadMermaids 関数
function loadMermaids() {
  var req = new XMLHttpRequest();                 // サーバのファイルを読む XMLHttpRequest
  req.addEventListener("readystatechange", () => {        // 準備状態に変化があった時の処理
      if(req.readyState === 4 && req.status === 200) {    // データ受信が正常に完了したら
          mermaids = JSON.parse(req.responseText);        // 読み込んだJSONデータを整形して人魚データに入れる
      }
  });
  req.open("GET", "main.json");               // リクエストを設定
  req.send();                                     // リクエストを送る
}

// ★人魚を地図上に配置する placeMermaids 関数
function placeMermaids() {
  var mermaidMark = [];                           // 人魚マーカーの配列
  for(var i = 0; i < mermaids.length; i++) {      // 全ての人魚について
      var pos = new google.maps.LatLng(mermaids[i].lat, mermaids[i].lng); // 人魚の位置を設定
      var img = {                                 // 画像の設定
          url: mermaids[i].img,                   // 画像ファイル名
          scaledSize: new google.maps.Size(60, 60)    // 画像を縮小表示
      };
      mermaidMark[i] = new google.maps.Marker({   // 人魚のマーカーを作成
          map: gmap,                              // gmap の上に表示する
          position: pos,                          // pos の位置に
          icon: img,                              // アイコンを設定
          title: mermaids[i].name                 // タイトルを設定
      });
      captured[i] = false;                        // 捕獲済み状態を全てfalseにする
  }
}

// ★自分と人魚との距離を計算する calcDistance 関数
function calcDistance(lat, lng) {
  var distance = [];                              // 距離を入れる配列
  var myPos = new google.maps.LatLng(lat, lng);   // Googleマップの LatLng オブジェクトを作成
  for(var i = 0; i < mermaids.length; i++) {      // 全ての人魚について
      var pos = new google.maps.LatLng(mermaids[i].lat, mermaids[i].lng);                 // 人魚の位置を設定
      distance[i] = google.maps.geometry.spherical.computeDistanceBetween(myPos, pos);    // 距離を求める
      // 捕獲の判定と捕獲した時のエフェクト
      if(distance[i] < 20 && captured[i] === false) {         // 距離が20m未満、かつ、まだ捕獲していないなら
          captured[i] = true;                                 // 捕獲済にする

          /*//動画再生
          $(function(){
            var player = $('#player').get(0);	//videoタグの要素を取得
            
            player.play();	//動画の再生
            
            //動画が終了したことを検出して発火する処理
            player.addEventListener('ended',function() {
              $('#player').remove();	//videoタグをDOM的に削除
            });
          })*/

          getImg.src = mermaids[i].img;                       // 捕獲された人魚の画像を設定
          context.drawImage(getImg, i * 60, 0, 60, 60);       // 捕獲済の枠に人魚の画像を表示
          getImg.hidden = false;                              // img要素を表示
          mapDiv.hidden = true;                               // 地図を非表示
          getImg.addEventListener("click", () => {            // img要素がクリックされたら
              getImg.hidden = true;                           // img要素を非表示
              mapDiv.hidden = false;                          // 地図を表示
          });
      }
  }
}
</script>

<!-- Google マップを読み込むための外部スクリプトの読み込み -->
<!-- API_KEY の部分を自身で取得した APIキーで置き換える -->
<!-- callback=initMap により、マップの準備ができたら initMap 関数が実行される -->
<!-- ★距離を求めるライブラリを使うために末尾に「&libraries=geometry」を追加 -->
<script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBgi7ZtevTVN2QlED7qRh3IEw54DHYgVOs&libraries=geometry">
</script>

<div align="center" class="example">
  <a href="https://snoopy2121.github.io/20221201/ARkansei/index.oubo.html" class="btn btn-flat"><span><font size="5">抽選画面へ</font></span></a>
</div>

